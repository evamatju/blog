// var siteList = {"result": [{"publisher": "admin", "name": "test3", "date": "2017-01-09", "progress": 0, "type": "critical", "id": "1483971179", "operator": "4", "detail": "a test"}, {"publisher": "admin", "name": "1", "date": "2017-01-09", "progress": 0, "type": "critical", "id": "1483973746", "operator": "1", "detail": "1"}, {"publisher": "1", "name": "\u53d8\u7535\u6240\u5012\u95ed\u64cd\u4f5c\u7968", "date": "2017-01-10", "progress": 0, "type": "common", "id": "1484032169", "operator": "\u5f20\u4e09", "detail": "\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e00\u5957\u5fae\u673a\u4fdd\u62a4A\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e00\u5957\u6bcd\u5dee\u538b\u677f1SLP1\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e00\u5957\u5fae\u673a\u4fdd\u62a4B\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e00\u5957\u6bcd\u5dee\u538b\u677f1SLP2\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e00\u5957\u5fae\u673a\u4fdd\u62a4C\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e00\u5957\u6bcd\u5dee\u538b\u677f1SLP3\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e8c\u5957\u5fae\u673a\u4fdd\u62a4A\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e8c\u5957\u6bcd\u5dee\u538b\u677f1SLP1\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e8c\u5957\u5fae\u673a\u4fdd\u62a4B\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e8c\u5957\u6bcd\u5dee\u538b\u677f1SLP2\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf\u829d\u94c12R12\u7ebf\u7b2c\u4e8c\u5957\u5fae\u673a\u4fdd\u62a4C\u76f8\u5931\u7075\u542f\u52a8\u7b2c\u4e8c\u5957\u6bcd\u5dee\u538b\u677f1SLP3\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf220kV\u7b2c\u4e00\u5957\u6bcd\u5dee\u8df3\u829d\u94c12R12\u7ebf\u5f00\u5173\u51fa\u53e3\u538b\u677f3LP4\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u6d4b\u91cf220kV\u7b2c\u4e8c\u5957\u6bcd\u5dee\u8df3\u829d\u94c12R12\u7ebf\u5f00\u5173\u51fa\u53e3\u538b\u677f3LP4\u4e24\u7aef\u786e\u65e0\u7535\u538b\uff0c\u653e\u4e0a\u8be5\u538b\u677f\uff0c\u5e76\u68c0\u67e5\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u4e00\u6b21\u8bbe\u5907\u786e\u5728\u51b7\u5907\u7528\u72b6\u6001\r\n\u5408\u4e0a\u829d\u94c12R12\u7ebf\u7ebf\u8def\u538b\u53d8\u4f4e\u538b\u7a7a\u6c14\u5f00\u5173ZKK\uff0c\u5e76\u68c0\u67e5\r\n\u5408\u4e0a\u829d\u94c12R12\u7ebf\u526f\u6bcd\u95f8\u5200\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u526f\u6bcd\u95f8\u5200\u4f4d\u7f6e\u6307\u793a\u706f\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u526f\u6bcd\u95f8\u5200\u673a\u68b0\u4f4d\u7f6e\u6307\u793a\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u5408\u4e0a\u829d\u94c12R12\u7ebf\u8def\u95f8\u5200\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u7ebf\u8def\u95f8\u5200\u4f4d\u7f6e\u6307\u793a\u706f\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u526f\u6bcd\u95f8\u5200\u673a\u68b0\u4f4d\u7f6e\u6307\u793a\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5220kV\u7ebf\u8def\u3001\u4e3b\u53d8\u7535\u5ea6\u8868\u91cd\u52a8\u7ee7\u7535\u5668\u5c4f\u829d\u94c12R12\u7ebf\u7535\u538b\u91cd\u52a8\u7ee7\u7535\u56684YQJ\u52b1\u78c1\u30013YQJ\u5931\u78c1\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u7b2c\u4e00\u7ec4\u64cd\u4f5c\u7bb1\u6307\u793a\u706fII\u6bcd\u8fd0\u884c\u4eae\u3001I\u6bcd\u8fd0\u884c\u706d\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u7b2c\u4e8c\u7ec4\u64cd\u4f5c\u7bb1\u6307\u793a\u706fII\u6bcd\u8fd0\u884c\u4eae\u3001I\u6bcd\u8fd0\u884c\u706d\r\n\u68c0\u67e5220kV\u7b2c\u4e00\u5957\u6bcd\u5dee\u4fdd\u62a4\u5c4f\u829d\u94c12R12\u7ebf\u95f8\u5200\u4f4d\u7f6e\u663e\u793a\u6b63\u786e\uff0c\u6309\u4e0b\u5200\u95f8\u4f4d\u7f6e\u786e\u8ba4\u6309\u94ae1FA\uff0c\u5e76\u68c0\u67e5\r\n\u68c0\u67e5220kV\u7b2c\u4e8c\u5957\u6bcd\u5dee\u4fdd\u62a4\u5c4f\u829d\u94c12R12\u7ebf\u95f8\u5200\u4f4d\u7f6e\u663e\u793a\u6b63\u786e\uff0c\u6309\u4e0b\u4fe1\u53f7\u590d\u5f52\u6309\u94aeRT\uff0c\u5e76\u68c0\u67e5\r\n\u5c06\u829d\u94c12R12\u7ebf\u9065\u63a7\u5f00\u5173QK\u5207\u81f3\u201c\u8fdc\u63a7\u201d\u4f4d\u7f6e\uff0c\u5e76\u68c0\u67e5\r\n\u68c0\u67e5\u76d1\u63a7\u540e\u53f0\u673a\u4e0a\u829d\u94c12R12\u7ebf\u526f\u6bcd\u95f8\u5200\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5\u76d1\u63a7\u540e\u53f0\u673a\u4e0a\u829d\u94c12R12\u7ebf\u7ebf\u8def\u95f8\u5200\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u5408\u4e0a\u829d\u94c12R12\u7ebf\u5f00\u5173\r\n\u68c0\u67e5\u76d1\u63a7\u540e\u53f0\u673a\u4e0a\u829d\u94c12R12\u7ebf\u5f00\u5173\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u5f00\u5173\u4f4d\u7f6e\u6307\u793a\u706f\u5728\u5408\u95f8\u4f4d\u7f6e\r\n\u68c0\u67e5\u829d\u94c12R12\u7ebf\u5f00\u5173\u673a\u68b0\u4f4d\u7f6e\u6307\u793a\u5728\u5408\u95f8\u4f4d\u7f6e"}], "error": false}
// var userList = { "result": [{"name":"1","pw":"123456","level":"high"},{"name":"2","pw":"465789","level":"low"}]};
function getruntime()
{
	$.ajax({
		url: '/api/getServiceRunTime',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8',
		method: 'POST',
		dataType: 'json',
		cache: false,
		data: { },
		success: function (json) {


 					// var strs=json.RunTime.split('|');
 					// var version=json.version;
 					// var str=str_run_time+": "+strs[0]+"D-"+strs[1]+"H-"+strs[2]+"M-"+strs[3]+"S"
 					// document.getElementById('dvruntime').innerHTML=str+"  ["+version+"]";
 				},
 				error:function(msg)
 				{
 					alert(msg.textStatus);
 				}
 			});
}
window.onload = function () {
// 	   getruntime();
// 	setInterval("getruntime()",1000);
}
function fLoad()
{
	
// 	getruntime();
// 	setInterval("getruntime()",1000);
}
//++++++++++++++++++++++++++++++++++++++++++++++
//cookie 读取
function getCookie(name)
{
	var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
	if(arr=document.cookie.match(reg))
		return unescape(arr[2]);
	else
		return null;
}
//登录检测
function loginInCheck(json) {
	var cookie = getCookie("username");
	
	if(cookie == "" || cookie == null){
		window.location.href = "login.html";
		return false;
	} 
	return true;
}
//++++++++++++++++++++++++++++++++++++++++++++++
//添加/修改工单
//已完成用绿色表示
//进行中用黄色表示
var arrayStatus = {"finished":" finished","undergoing":"ongoing"};
var gOrders ;
function orderPreCheck(){
	if($('#txtname').val()==null||$('#txtname').val()=='')
	{
		alert(str_order_name_warn);
		return 0;
	}
	if($('#txtdetail').val()==null||$('#txtdetail').val()=='')
	{
		alert(str_order_detail_warn);
		return 0;
	}
	if($('#txttouser').val()==null||$('#txttouser').val()=='')
	{
		alert(str_order_detail_warn);
		return 0;
	}
	if(!isPort($('#txtname').val(),str_order_name_warn1))
		return 0;
	if(!isPort($('#txtdetail').val(),str_order_detail_warn1))
		return 0;
	if(!isPort($('#txttouser').val(),str_emer_warn1))
		return 0;
	return 1;
}
function orderPreCheck1(){
	if($('#txtname1').val()==null||$('#txtname1').val()=='')
	{
		alert(str_order_name_warn);
		return 0;
	}
	if($('#txtdetail1').val()==null||$('#txtdetail1').val()=='')
	{
		alert(str_order_detail_warn);
		return 0;
	}
	if($('#txttouser1').val()==null||$('#txttouser1').val()=='')
	{
		alert(str_order_detail_warn);
		return 0;
	}
	if($('#type1').val()==null||$('#type1').val()=='')
	{
		alert(str_emer_warn);
		return 0;
	}
	if(!isPort($('#txtname1').val(),str_order_name_warn1))
		return 0;
	if(!isPort($('#txtdetail1').val(),str_order_detail_warn1))
		return 0;
	if(!isPort($('#txttouser1').val(),str_emer_warn1))
		return 0;

	if(!isPort($('#type1').val(),str_emer_warn1))
		return 0;
	return 1;
}
function addJobOrder()
{
	var stat = orderPreCheck();
	if (stat == 0) return false;

	var detailInfo = $("#add-detail-first  textarea");
	var detail = "";
	detailInfo.each(function(index,data){
		detail += data.value;
		detail += "\r\n";
	})

	$.ajax({
		url: '/add_order/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"orderName": $('#txtname').val(),"detail":detail,"type":$("#type").val(),"operator":$("#txttouser").val(),"publisher":sessionStorage.username},
		
		// var data = {"orderName": $('#txtname').val(),"detail":detail,"type":$("#type").val(),"operator":$("#txttouser").val(),"publisher":sessionStorage.username};
		// console.log(data);

		success: function (json) {
			if(! loginInCheck(json) ) return false;
			if (json.error == false){
				alert(str_warn_s);
				window.location.href='order.html';
			} else {
				alert(str_warn_f);
				window.location.reload();
			} 
		},
		error:function(msg)
		{
			alert(msg.responseText);
			alert(msg.status);
		}
	});
}

function getJobOrderDetail(orderId) {
	$.ajax({
		url: '/get_order/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'GET',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"type":"all"},
		success: function (json) {
			// var json = siteList;
			console.log(json);
			var progress = ["未完成","已完成"];
			if( !loginInCheck(json) ) return false;
			var info="";
			json = json.result;
			json.forEach(function(oneOrder) {
				if(oneOrder.id == orderId)
					info = oneOrder;

			})
			document.getElementById("detail-name").innerHTML = info.name;
			document.getElementById("detail-orderId").innerHTML = info.id;
			document.getElementById("detail-publisher").innerHTML = info.publisher;
			document.getElementById("detail-operator").innerHTML = info.operator;
			document.getElementById("detail-date").innerHTML = info.date;

			var detailList = info.detail.split("\r\n");
			var html = "";
			for(var i = 0; i < detailList.length ; i++) {
				html += "<tr>\
				<td>"+ i +"</td>\
				<td>"+ detailList[i] +"</td><td>"
				if(i < info.progress){
					html += progress[0];
				} else {
					html+=progress[1];
				}
				html += "</td></tr>"
			}
			document.getElementById("order-dertail-content").innerHTML = html;



		},
		error:function(err)
		{	alert(err.responseText)}
	});
}
function getJobOrders(select) {
	
	$.ajax({
		url: '/get_order',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'GET',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"type":select},
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			// var json = siteList;
			json = json.result;
			var count = json.length;
			var html = "";
			for (var i = 0; i < count ; i++) {
				html += "  <div class=\"col-sm-6\"> \
				<div class=\"order-component"+" "+ arrayStatus[""+json[i].status]  +"\"> \
				<div class=\"modal-header\"> <h5> " + json[i].id + "</h5></div> \
				<div class=\"modal-body\"> \
				<div class=\"row\"> \
				<div class=\"col-sm-3\"> \
				<img src=\"  " +  json[i].type +  "  .jpg \" alt=\"类型标志\" title=\"类型\" /> \
				</div> \
				<div class=\"col-sm-9\"> \
				<h5> "+  json[i].name  + "</h5> \
				<p class=\"detail\"> "+  json[i].detail + "</p> \
				</div> \
				</div> \
				</div> \
				<div class=\"modal-footer\"> \
				<a data-toggle=\"modal\"  href=\"order.html#modal-form-detail\" class=\"btn btn-primary\" onclick=\"getJobOrderDetail(" +  json[i].id + ")\">详情</a> \
				&nbsp;&nbsp; \
				<a data-toggle=\"modal\"  href=\"order.html#modal-form-modify\" class=\"btn btn-primary\" onclick=\"getJobOrder(" +  json[i].id + ")\">修改</a> \
				&nbsp;&nbsp; \
				<a data-toggle=\"modal\"  onclick=\"deleteOrder("+  json[i].id+")\" class=\"btn btn-default\">删除</a> \
				</div> \
				</div> \
				</div>"
			}

			document.getElementById("order-list-content").innerHTML = html;

		},
		error:function(msg)
		{	alert(msg);}
	});

}

//修改时显示目前信息用
function getJobOrder(orderId) {	
	$.ajax({
		url: '/get_order/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'GET',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"type": "all"},
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			// var json = siteList;
			var info="";
			var json = json.result;
			json.forEach(function(oneOrder) {
				if(oneOrder.id == orderId)
					info = oneOrder;

			})
			$("#modify-name").val(info.name);
			$("#modify-id").val(info.id);
			$("#modify-publisher").val(info.publisher);
			$("#modify-operator").val(info.operator);
			$("#modify-date").val(info.date);
			$("#modify-progress").val(info.progress);

			var detailList = info.detail.split("\r\n");
			var html = "";
			for(var i = 0; i < detailList.length ; i++) {
				html += "<textarea type=\"text\"  class=\"form-control-input\" value=\"\">"+ detailList[i] +" </textarea>";
				html += "<input type=\"button\"  value=\"删除详情\" class=\"pull-left\" onclick=\"deleteDetail(this)\">";
			}
			document.getElementById("modify-detail-content").innerHTML = html;
			$("#modify-submit").click(function(){
				modifyJobOrder(orderId);
			});
		},
		error:function(msg)
		{	alert(msg)}
	});
}
// 单放
function addDetail(strEle) {
	var html = "<textarea type=\"text\"  class=\"form-control-input\" value=\"\"> </textarea>\
	<input type=\"button\"  class=\"pull-left\" value=\"删除详情\" onclick=\"deleteDetail(this)\" />";
	$(strEle).append(html);
}
function deleteDetail(srcEle){
	var target = $(srcEle.previousElementSibling);
	// target.parent(ELement).removeChild(target);
	$(srcEle).remove();
	target.remove();
}
// 结束单放
function modifyJobOrder (id) {
	
	// var stat = orderPreCheck1();
	// if (stat == 0) return false;

	var detailInfo = $("#modify-detail-content  textarea");
	var detail = "";
	detailInfo.each(function(index,data){
		detail += data.value;
		detail += "\r\n";
	})

	var data = {"orderName": $("#modify-name").val(),"detail":detail,"type":$("#modify-type").val(), "progress":$("#modify-progress").val(),"operator ":$("#modify-operator").val(),"orderId":id};
console.log(data);

	$.ajax({
		url: '/ch_order/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"name": $("#modify-name").val(),"detail":detail,"type":$("#modify-type").val(), "progress":$("#modify-progress").val(),"operator":$("#modify-operator").val(),"orderId":id},

// var data = {"orderName": $("#modify-name").val(),"detail":detail,"type":$("#modify-type").val(), "progress":$("#modify-progress").val(),"operator ":$("#modify-operator").val(),"orderId":id};
// console.log(data);

success: function (json) {
	if( !loginInCheck(json) ) return false;
	if (json.error == false){
		alert(json.responseText);
		window.location.href='order.html';
	} else {
		alert(str_warn_f);
		window.location.reload();
	} 


},
error:function(msg)
{	alert(msg.responseText);}
});
}
function deleteOrder(id) {
	
	if(confirm(str_confirm_delete))
	{
		$.ajax({
			url: '/del_order/',
			contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
			method: 'POST',
			dataType: 'json',
			cache: false,
			async: false,
			data: {"orderId": id},
			success: function (json) {
				if( !loginInCheck(json) ) return false;
				alert(str_warn_s);
				window.location.reload();

			},
			error:function(msg)
			{	alert("error");}
		});
	}
}

//++++++++++++++++++++++++++++++++++++++++++++++
// 管理员设置
//加一个用户
function addOneUser(){	
	if($('#txtnewuser').val()==null||$('#txtnewuser').val()=='')
	{
		alert("用户为空");
		return false;
	}
	if($('#txtnewpass1').val()==null||$('#txtnewpass1').val()==''|| $('#txtnewpass2').val()==null || $('#txtnewpass2').val()=='')
	{
		alert("密码为空");
		return false;
	}
	if( $('#txtnewpass1').val() !== $('#txtnewpass2').val())
	{
		alert("不一致");
		return false;
	}
		var data = {"name": $('#txtnewuser').val(),"level":$('input:radio[name="level"]:checked').val(),"pw":$('#txtnewpass1').val()};
		console.log(data);
	$.ajax({
		url: '/add/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"name": $('#txtnewuser').val(),"level":$('input:radio[name="level"]:checked').val(),"pw":$('#txtnewpass1').val()},
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			alert(str_warn_s);
			window.location.reload();
		},
		error:function(xhr)
		{	alert(xhr.readyState+" "+xhr.statusText+" " + xhr.responseText)}
	});
}

//删除目标用户
function deleteUser(name)
{	
	if(confirm(str_confirm_delete))
	{
		$.ajax({
			url: '/del_user/',
			contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
			method: 'POST',
			dataType: 'json',
			cache: false,
			async: false,
			data: {"name": name},
			success: function (json) {
				if( !loginInCheck(json) ) return false;
				alert(str_warn_s);
				window.location.reload();				
			},
			error:function(msg)
			{	alert("error");}
		});
	}
}

//修改用，显示单个用户信息
function getUser (name) {
	
	$.ajax({
		url: '/api/getUser',
		contentType: 'application/x-www-form-urlencoded; cahrset = utf-8',
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {n1: name},

		success: function (json) {
			if( !loginInCheck(json) ) return false;
			$("#user-name"). val(json.userName);
			$("#user-name"). attr("disabled","disabled");

		} ,
		error: function(msg){
			alert( msg.textStatus);
		}
	})
}
//改目标用户密码
function reSetUserPwdRender(name){
	$("#user-name"). val(name);
	$("#user-name"). attr("disabled","disabled");
	$("#modal-form button").click(function(){
		reSetUserPwd(name);
	});
}

function reSetUserPwd(name) {
	var oldPw = $("#oldPw").val();
	var newPw1 = $('#txtnewpass11').val();
	var newPw2 = $("#txtnewpass22").val();
	if( newPw1==null|| newPw1==''|| newPw2==null || newPw2=='')
	{
		alert("密码为空");
		return false;
	}
	if( newPw1!== newPw2)
	{
		alert("两次密码不一致");
		return false;
	}
	$.ajax({
		url: '/ch_pw/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {"name": name,"oldPw":oldPw,"newPw":newPw2},
		success: function (json) {

			if( !loginInCheck(json) ) return false;
			alert(json);
			console.log(json);
			window.location.reload();
		},
		error:function(xhr)
		{	alert(xhr.readyState+" "+xhr.statusText+" " + xhr.responseText)}
	});
	// var data = {"name": name,"oldPw":oldPw,"newPw":newPw2};
	// console.log(data);
}

//查所有用户
function getUsers()
{
	$.ajax({
		url: '/get_user/',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'GET',
		dataType: 'json',
		cache: false,
		async: false,
		data: {},
		success: function (json) {
			// var json = userList;
			if( !loginInCheck(json) ) return false;
			var pagecount = json.result.length;
			if(pagecount == '0') {
				var html = "";
				document.getElementById("user-list-content").innerHTML = html; 
			} else {
				OutputHtmlPerson(parseInt(pagecount),1,json);
			}			
		},
		error:function(msg){	
			alert(msg.responseText);}
		});			
}

//++++++++++++++++++++++++++++++++++++++++++++++
//用户组
//查目标用户组
function getUserGroupList() {

	$.ajax({
		url: '/api/getUserGroupList',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: { },
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			var pagecount = json.EasyDarwin.Body.UserCount;
			if(pagecount == '0') {
				var html = "";
				document.getElementById("user-list-content").innerHTML = html; 
			} else {
				OutputHtmlPerson(parseInt(pagecount),1,json);
			}			
		},
		error:function(msg){	
			alert(msg.textStatus);}
		});
}
function addUserGroup()
{
	if($('#txtnewuser1').val()==null||$('#txtnewuser1').val()=='')
	{
		alert(str_new_user_warn);
		return false;
	}
	if($('#txtnewpass1').val()==null||$('#txtnewpass1').val()==''|| $('#txtnewpass2').val()==null || $('#txtnewpass2').val()=='')
	{
		alert(str_new_user_warn);
		return false;
	}
	if( $('#txtnewpass1').val() !== $('#txtnewpass2').val())
	{
		alert(str_new_user_warn1);
		return false;
	}
	$.ajax({
		url: '/api/addUserGroup',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: {n1: $('#txtnewuser').val(),n2:$('#txtnewpass1')},
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			alert(str_warn_s);
			window.location.reload();
		},
		error:function(msg)
		{	alert("error");}
	});
}
//删除目标用户组 
function deleteUserGroup(name)
{
	if(confirm(str_confirm_delete))
	{
		$.ajax({
			url: '/api/deleteUserGroup',
			contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
			method: 'POST',
			dataType: 'json',
			cache: false,
			async: false,
			data: {"deleteUser": name},
			success: function (json) {
				if( !loginInCheck(json) ) return false;
				alert(str_warn_s);
				window.location.reload();
				
			},
			error:function(msg)
			{	alert("error");}
		});
	}
}
//++++++++++++++++++++++++++++++++++++++++++++++
//RTMP直播列表
// function gotoAddHlsList()
// {
// 	window.location.href='addhlslist.html';
// 	return false;
// }
// function gotoHlsList()
// {
// 	window.location.href='hlslist.html';
// 	return false;
// }
function getRTMPList()
{
//var baseUrl= 'rtmp://192.168.1.3:1935/myapp/live' ;
//var  name = "异常告警检测name";
//var id = "异常检测id";
//var html = "<div class=\"col-sm-12\"> <div class=\"order-component\">\
//						<div class=\"modal-body1\" onclick=\"load('"+ baseUrl +"')\"> <h5>"+id+"</h5> <h5>"+name+"</h5></div></div></div>"
//document.getElementById("divload").innerHTML= html;

$.ajax({
	url: '/get_order/',
	contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
	method: 'GET',
	dataType: 'json',
	cache: false,
	async: false,
	data: {"type":"undergoing"},
	success: function (json1) {
		if( !loginInCheck(json) ) return false;
			// var baseUrl= 'rtmp://192.168.1.3:1935/myapp/live' ;
			var json = json1.result;
			var pagecount = json.length;
					// var pagecount=siteList.EasyDarwin.Body.SessionCount;
					if(pagecount=="0")
					{
						document.getElementById("divload").innerHTML= html;
					}
					else{
						OutputHtml(parseInt(pagecount),1,json);
					}

				},
				error:function(msg)
				{	alert("getrtmplist"+msg);}
			});
}
function BHLSNameRepeat()
{
	var re=false;
	$.ajax({
		url: '/api/getHLSList',
		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
		method: 'POST',
		dataType: 'json',
		cache: false,
		async: false,
		data: { },
		success: function (json) {
			if( !loginInCheck(json) ) return false;
			var pagecount=json.EasyDarwin.Body.SessionCount;
			for(var i = 0;i < pagecount;i ++)
			{
				if($('#txtname').val()==json.EasyDarwin.Body.Sessions[i].name)
				{
					re=true;

					break;
				}
			}

		},
		error:function(msg)
		{	}
	});
	
	return re;
}
function addRTMPList()
{
	
	if($('#txtname').val()==null||$('#txtname').val()=='')
	{
		alert(str_hls_list_name_warn);
		return false;
	}
	if($('#txturl').val()==null||$('#txturl').val()=='')
	{
		alert(str_hls_list_url_warn);
		return false;
	}
	if($('#txttimeout').val()==null||$('#txttimeout').val()=='')
	{
		alert(str_hls_list_timeout_warn);
		return false;
	}
	if(!istime($('#txttimeout').val(),str_hls_list_timeout_warn1))
		return false;
	
	if(BHLSNameRepeat()==true)
	{
		
		alert(str_hls_list_name_warn1);
		return false;
	}
	else{
		$.ajax({
			url: '/api/addHLSList',
			contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
			method: 'POST',
			dataType: 'json',
			cache: false,
			async: false,
			data: {n1: $('#txtname').val(),n2: $('#txturl').val(),n3: $('#txttimeout').val()},
			success: function (json) {
				if( !loginInCheck(json) ) return false;

				if(json.result=="1")
				{
					alert(str_warn_s);
					window.location.href='hlslist.html';

				}
				else{
					alert(str_warn_f);
					window.location.reload();
				}

			},
			error:function(msg)
			{	alert("error");}
		});
		return false;
	}
	
	
}
//++++++++++++++++++++++++++++++++++++++++++++++
function GetQueryString(name)
{
	var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	var r = window.location.search.substr(1).match(reg);
	if(r!=null)return  unescape(r[2]); return null;
}

/*function load(seturl) {
           
            var url = seturl;
             var snap = '';
             var flashvars = {
                 f: 'm3u8.swf',
                 a: url,
                 c: 0,
                 s: 4,
                 lv: 1,
                 p:1
               
             };
             var params = { bgcolor: '#FFF', allowFullScreen: true, allowScriptAccess: 'always' }; //这里定义播放器的其它参数如背景色（跟flashvars中的b不同），是否支持全屏，是否支持交互
             var video = [url , url , url ];
             
             CKobject.embed('ckplayer/ckplayer.swf', 'dvplay', 'ckplayer_dvplay', '100%', '100%', false, flashvars, video, params);
         }*/

         function getpar(name)
         {
         	var name=GetQueryString(name);
         	var url=null;
         	$.ajax({
         		url: '/api/getRTMPList',
         		contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
         		method: 'POST',
         		dataType: 'json',
         		cache: false,
         		async: false,
         		data: { },
         		success: function (json) {
         			var pagecount=json.EasyDarwin.Body.SessionCount;
         			for(var i = 0;i < pagecount;i ++)
         			{
         				if(name==json.EasyDarwin.Body.Sessions[i].name)
         				{
         					url=json.EasyDarwin.Body.Sessions[i].url;

         					break;
         				}
         			}

         		},
         		error:function(msg)
         		{	}
         	});
         	load(url);
         }
//++++++++++++++++++++++++++++
function gotolist()
{	

	window.location.href='hlslist.html';
	return false;
}

// function getRTSPList()
// {
	
// 	$.ajax({
//                 url: '/api/getRTMPList',
// 				contentType: 'application/x-www-form-urlencoded; charset=utf-8', 
//                 method: 'POST',
//                 dataType: 'json',
// 				cache: false,
// 				async: false,
//                 data: { },
//                 success: function (json) {
// 					var pagecount=json.EasyDarwin.Body.SessionCount;
// 					//var pagecount=siteList.EasyDarwin.Body.SessionCount;
// 					if(pagecount=="0")
// 					{
// 						var html="<div class=\"panel-body no-padding\" ><table class=\"table table-striped table-bordered table-hover\"><thead><tr><th>Index</th><th>Name</th><th>Source</th><th>Url</th></tr></thead><tbody>";
// 						html+="</tbody></table></div>";
// 						document.getElementById("divload").innerHTML= html;
// 					}
// 					else{
// 							OutputHtml(parseInt(pagecount),1,json);
// 					}


//                 },
// 				error:function(msg)
// 				{	alert(msg.textStatus);}
//             });
// }